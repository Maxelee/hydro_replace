# Existing Data Product Inventory

## Summary

We have **significant pre-computed data** that can be leveraged for all three papers. This document catalogs everything available to avoid redundant computation.

---

## 1. Power Spectra (z=0)

**Location**: `/mnt/home/mlee1/ceph/power_spectra/`  
**Total Files**: 198 files (~700 MB)  
**Resolution**: 1024³ grid  
**Computed From**: Pixelized replacement maps

### Format
- `*_Pk1D.txt`: 1D power spectrum (k, P(k))
- `*_Pk2D.npz`: 2D power spectrum (kpar, kper, Pk2D, Nmodes)
- `*_Pk3D.txt`: 3D multipoles (k, Pk0, Pk2, Pk4, Pkphase, Nmodes)

### Coverage Matrix

| Mode | Radius | Mass Bins (Regular) | Mass Bins (Cumulative) |
|------|--------|---------------------|------------------------|
| normal | 1× R_200 | 10-12.5, 12.5-13, 13-13.5, 13.5-14, gt14 | gt10, gt12, gt12.5, gt13, gt14 |
| normal | 3× R_200 | same | same |
| normal | 5× R_200 | same | same |
| inverse | 1× R_200 | same | same |
| inverse | 3× R_200 | same | same |
| inverse | 5× R_200 | same | same |

**Total configurations**: 2 modes × 3 radii × 11 mass bins = 66 P(k) sets × 3 types = 198 files

### Ready for Paper 1?
✅ **YES** - Full P(k) comparison ready for:
- Cumulative mass threshold analysis (Fig 7 style)
- Mass bin decomposition (Fig 8 style)
- Radius dependence analysis
- Inverse replacement for null tests

---

## 2. Pixelized Replacement Maps (z=0)

**Location**: `/mnt/home/mlee1/ceph/pixelized/`  
**Total Files**: 61 files (~8.7 GB)  
**Resolution**: 4096³ grid → 2D projections

### File Contents (per .npz)
- `hydro_density`: 2D projected hydro matter density
- `dmo_density`: 2D projected DMO matter density
- `replaced_density`: DMO with hydro particles swapped in

### Coverage
Same as power spectra (generated from these maps)

---

## 3. Baryonification Output (Arico BCM)

**Location**: `/mnt/home/mlee1/ceph/baryonification_output/halos/`  
**Total Halos**: 519 halos  
**Generated By**: `BCM.py` using BaryonForge (Arico+2020 model)

### File Format (per halo .h5)
| Key | Shape | Description |
|-----|-------|-------------|
| `baryonified_coords` | (N, 3) | BCM-displaced particle positions (within R_200) |
| `baryonified_coords_full` | (M, 3) | BCM-displaced positions (within 5×R_200) |
| `dmo_coords` | (M, 3) | Original DMO particle positions |
| `baryon_density` | (100,) | BCM density profile |
| `dmo_density` | (100,) | Original DMO density profile |
| `hydro_coords` | (P, 3) | TNG hydro particle positions (for comparison) |
| `hydro_density` | (100,) | True hydro density profile |
| `hydro_masses` | (P,) | Hydro particle masses |
| `profile_bins` | (101,) | Radial bin edges (in units of R_200) |
| `center` | (3,) | Halo center position |

### BCM Parameters Used
```python
BARYONIFICATION_PARAMS = dict(
    alpha_g=2, epsilon_h=0.015, M1_0=0.22e11/h, 
    M_c=0.23e14/h, eta=0.14, mu=0.31, beta=4.09, 
    epsilon_hydro=np.sqrt(5),
    M_inn=3.3e13/h, theta_inn=0.1, theta_out=5,
    theta_rg=0.3, sigma_rg=0.1, a=0.3, n=2, p=0.3, q=0.707
)
```

### Mass Selection
- Minimum mass: 10^12.8 M☉ (519 halos above this)

### Ready for Paper 2?
✅ **YES** - Direct BCM vs Hydro vs Replacement comparison possible:
- Per-halo density profiles in 100 radial bins
- BCM, DMO, and Hydro profiles all stored
- Can compute P(k) from baryonified coordinates

---

## 4. Halo Matching Catalog

**Location**: `/mnt/home/mlee1/ceph/halo_matches.npz`  
**Generated By**: `match_halos_parallel.py`

### Contents
- `dmo_indices`: DMO halo IDs
- `hydro_indices`: Matched hydro halo IDs

---

## 5. BCM_lensing Code (GitHub)

**Repository**: https://github.com/Maxelee/BCM_lensing/tree/parallel

### Key Components
- `BCM_lensing/halo.py`: Halo class for loading TNG data, NFW fitting
- `BCM_lensing/component.py`: BCM components (CG, BG, EG, RDM)
- `BCM_lensing/bcm_pos.py`: BCM_POS function for particle displacement
- `run_BCM.py`: Main script for baryonification + P(k) computation

### Notes
- Written for Illustris-3-Dark (smaller box: 75 Mpc/h)
- Uses nbodykit for P(k) computation
- Implements Arico+2020 BCM model
- **Can be adapted** for TNG-300 and other BCM models

---

## 6. lux Ray-Tracing

**Location**: `/mnt/home/mlee1/lux/`  
**Output**: `/mnt/home/mlee1/ceph/lux_out/`

### Status
- C++ ray-tracing code ready
- Requires 20 snapshots (z=0 to z≈2.9)
- Can create new branch for modifications

### Key Decision
**NOT doing lens plane replacement** - instead will modify lux directly to read baryonified/replaced snapshots.

---

## What's Missing / Needs to be Computed

### For Paper 1 (Peaks + P(k))
1. ⚠️ **Convergence maps** from ray-tracing (need lux modifications)
2. ⚠️ **Peak statistics** on convergence maps
3. ⚠️ **Multi-redshift P(k)** (5 pilot snapshots)

### For Paper 2 (BCM Comparison)
1. ⚠️ **Profile comparisons** (have data, need analysis)
2. ⚠️ **Multiple BCM models** (currently only Arico20)
3. ⚠️ **P(k) from BCM-modified snapshots**

### For Paper 3 (Emulator)
1. ⚠️ **CAMELS simulation processing**
2. ⚠️ **Parameter space exploration**

---

## Recommended Next Steps

### Immediate (This Week)
1. **Visualize existing P(k)** - Create suppression ratio plots from power_spectra/
2. **Analyze BCM profiles** - Compare baryon_density vs hydro_density for 519 halos
3. **Verify matching quality** - Check halo_matches.npz statistics

### 5-Snapshot Pilot
Process these snapshots for multi-z analysis:
| Snapshot | z | Priority | Notes |
|----------|---|----------|-------|
| 99 | 0.0 | ✅ Done | Have full P(k) |
| 76 | 0.5 | High | Mid-z check |
| 63 | 0.93 | High | z≈1 important |
| 49 | 1.5 | Medium | Higher z |
| 35 | 2.32 | Low | High-z evolution |

### lux Modifications
1. Create `hydro_replace` branch in lux repo
2. Add option to read pre-baryonified HDF5
3. Test with single snapshot before full run
